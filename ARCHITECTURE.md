# ç»Ÿä¸€æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ¯ é¡¹ç›®ç›®æ ‡

å®ç° **Electron å’Œ Web ç”¨ä¸€å¥—ä»£ç ** çš„ä¸²å£UDPè°ƒè¯•å·¥å…·ï¼Œé€šè¿‡æ™ºèƒ½çš„å¹³å°é€‚é…å±‚ï¼Œè®©åŒä¸€å¥— React ç»„ä»¶å’Œä¸šåŠ¡é€»è¾‘åœ¨ä¸¤ç§ç¯å¢ƒä¸­æ— ç¼è¿è¡Œã€‚

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React Components (app/, components/)                      â”‚
â”‚  â€¢ ç»Ÿä¸€çš„ç”¨æˆ·ç•Œé¢                                            â”‚
â”‚  â€¢ å“åº”å¼è®¾è®¡                                               â”‚
â”‚  â€¢ å¹³å°æ— å…³çš„äº¤äº’é€»è¾‘                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¹³å°é€‚é…å±‚ (Platform Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PlatformProvider + usePlatform Hook                       â”‚
â”‚  â€¢ è‡ªåŠ¨ç¯å¢ƒæ£€æµ‹                                             â”‚
â”‚  â€¢ åŠŸèƒ½ç‰¹æ€§æ˜ å°„                                             â”‚
â”‚  â€¢ ç»Ÿä¸€çš„APIæ¥å£                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Electron ç¯å¢ƒ         â”‚           Web ç¯å¢ƒ            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Node.js SerialPort       â”‚  â€¢ Web Serial API            â”‚
â”‚  â€¢ Node.js dgram (UDP)      â”‚  â€¢ WebSocket (UDPä»£ç†)       â”‚
â”‚  â€¢ åŸç”Ÿæ–‡ä»¶ç³»ç»Ÿ              â”‚  â€¢ æµè§ˆå™¨ä¸‹è½½API              â”‚
â”‚  â€¢ ç³»ç»Ÿé€šçŸ¥                  â”‚  â€¢ æµè§ˆå™¨é€šçŸ¥API              â”‚
â”‚  â€¢ çª—å£æ§åˆ¶                  â”‚  â€¢ æ ‡å‡†Web API               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. å¹³å°æ£€æµ‹ä¸é€‚é… (`lib/platform.ts`)

```typescript
// è‡ªåŠ¨æ£€æµ‹è¿è¡Œç¯å¢ƒ
export const detectPlatform = (): PlatformType => {
  if (typeof window !== 'undefined') {
    return (window as any).require ? 'electron' : 'web';
  }
  return 'web';
};

// ç»Ÿä¸€çš„åŠŸèƒ½é€‚é…å™¨
export class PlatformAdapter {
  static async saveFile(filename: string, content: string) {
    if (this.isElectron()) {
      // Electron: åŸç”Ÿæ–‡ä»¶å¯¹è¯æ¡†
    } else {
      // Web: æµè§ˆå™¨ä¸‹è½½
    }
  }
}
```

### 2. ç¯å¢ƒé…ç½® (`lib/environment.ts`)

```typescript
// ç‰¹æ€§æ£€æµ‹
export const features = {
  hasNodeSerial: isElectron() || isServer(),
  hasWebSerial: isWeb() && 'serial' in navigator,
  hasNodeUDP: isElectron() || isServer(),
  hasWebSocket: typeof WebSocket !== 'undefined',
  // ...æ›´å¤šç‰¹æ€§
};
```

### 3. React ä¸Šä¸‹æ–‡æä¾›è€… (`components/PlatformProvider.tsx`)

```typescript
// ä¸ºæ•´ä¸ªåº”ç”¨æä¾›å¹³å°ä¿¡æ¯å’ŒåŠŸèƒ½
export function PlatformProvider({ children }) {
  const platformFeatures = {
    platform,
    features: { /* æ£€æµ‹åˆ°çš„åŠŸèƒ½ */ },
    actions: { /* é€‚é…åçš„æ–¹æ³• */ }
  };
  
  return (
    <PlatformContext.Provider value={platformFeatures}>
      {children}
    </PlatformContext.Provider>
  );
}
```

### 4. ç¡¬ä»¶ç®¡ç†å™¨ (`lib/hardware-manager.ts`)

```typescript
// ç»Ÿä¸€çš„ç¡¬ä»¶æ¥å£ï¼Œè‡ªåŠ¨é€‚é…ä¸åŒç¯å¢ƒ
export class HardwareManager {
  async connectSerial(config) {
    if (this.isElectron) {
      // ä½¿ç”¨ Node.js serialport
    } else {
      // ä½¿ç”¨ Web Serial API æˆ– WebSocket ä»£ç†
    }
  }
}
```

## ğŸš€ æ„å»ºæµç¨‹

### ç»Ÿä¸€æ„å»ºç®¡ç†å™¨ (`build-config.js`)

```javascript
class BuildManager {
  async buildWeb() {
    process.env.BUILD_MODE = 'web';
    execSync('npm run build:web');
  }
  
  async buildElectron() {
    process.env.BUILD_MODE = 'electron';
    execSync('npm run build:electron');
  }
  
  async buildAll() {
    await this.buildWeb();
    await this.buildElectron();
  }
}
```

### Next.js é…ç½®é€‚é… (`next.config.js`)

```javascript
const nextConfig = {
  // æ ¹æ®æ„å»ºæ¨¡å¼åŠ¨æ€é…ç½®
  ...(process.env.BUILD_MODE === 'electron' && {
    output: 'export',        // é™æ€å¯¼å‡ºç»™ Electron
    distDir: 'out',         // è¾“å‡ºåˆ° out ç›®å½•
    images: { unoptimized: true }
  })
};
```

## ğŸ“± ç”¨æˆ·ä½“éªŒç»Ÿä¸€

### 1. ç•Œé¢ä¸€è‡´æ€§
- ç›¸åŒçš„ React ç»„ä»¶åœ¨ä¸¤ä¸ªç¯å¢ƒä¸­æ¸²æŸ“
- ç»Ÿä¸€çš„æ ·å¼å’Œäº¤äº’é€»è¾‘
- å“åº”å¼è®¾è®¡é€‚é…ä¸åŒå±å¹•

### 2. åŠŸèƒ½é€‚é…
- è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒèƒ½åŠ›
- ä¼˜é›…é™çº§ä¸æ”¯æŒçš„åŠŸèƒ½
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

### 3. æ•°æ®æŒä¹…åŒ–
- Electron: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
- Web: LocalStorage + ä¸‹è½½

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### å¼€å‘æ¨¡å¼
```bash
npm run dev
# åŒæ—¶å¯åŠ¨ Next.js å¼€å‘æœåŠ¡å™¨å’Œ Electron
```

### æ„å»ºéƒ¨ç½²
```bash
npm run build        # æ„å»ºæ‰€æœ‰ç‰ˆæœ¬
npm run build:web    # ä»…æ„å»º Web ç‰ˆæœ¬
npm run build:electron # ä»…æ„å»º Electron ç‰ˆæœ¬
```

### æ‰“åŒ…åˆ†å‘
```bash
npm run pack         # æ‰“åŒ… Electron åº”ç”¨
npm run dist:win     # Windows å®‰è£…åŒ…
npm run dist:mac     # macOS å®‰è£…åŒ…
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å¹³å°å…¼å®¹æ€§æµ‹è¯•
```bash
node test-platform.js  # æ£€æŸ¥å¹³å°é€‚é…é…ç½®
npm run test:build     # æµ‹è¯•æ„å»ºæµç¨‹
```

### åŠŸèƒ½æµ‹è¯•
- ä¸²å£é€šä¿¡åœ¨ä¸¤ä¸ªç¯å¢ƒä¸­çš„è¡¨ç°
- UDPé€šä¿¡çš„ä¸åŒå®ç°æ–¹å¼
- æ–‡ä»¶ä¿å­˜åŠŸèƒ½çš„é€‚é…
- é€šçŸ¥ç³»ç»Ÿçš„å…¼å®¹æ€§

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ä»£ç åˆ†å‰²
- å¹³å°ç‰¹å®šä»£ç æŒ‰éœ€åŠ è½½
- å‡å°‘ä¸å¿…è¦çš„ä¾èµ–æ‰“åŒ…

### èµ„æºä¼˜åŒ–
- å›¾ç‰‡å’Œé™æ€èµ„æºä¼˜åŒ–
- å­—ä½“å’Œæ ·å¼å‹ç¼©

### è¿è¡Œæ—¶ä¼˜åŒ–
- æ‡’åŠ è½½éå…³é”®ç»„ä»¶
- å†…å­˜ä½¿ç”¨ç›‘æ§

## ğŸ”’ å®‰å…¨è€ƒè™‘

### Web ç¯å¢ƒ
- HTTPS è¦æ±‚ï¼ˆWeb Serial APIï¼‰
- ç”¨æˆ·æƒé™è¯·æ±‚
- è·¨åŸŸèµ„æºå…±äº«

### Electron ç¯å¢ƒ
- ä¸Šä¸‹æ–‡éš”ç¦»
- é¢„åŠ è½½è„šæœ¬å®‰å…¨
- åŸç”Ÿæ¨¡å—æƒé™

## ğŸ“ˆ æ‰©å±•æ€§

### æ·»åŠ æ–°å¹³å°
1. åœ¨ `platform.ts` ä¸­æ·»åŠ æ£€æµ‹é€»è¾‘
2. å®ç°å¹³å°ç‰¹å®šçš„é€‚é…å™¨æ–¹æ³•
3. æ›´æ–°åŠŸèƒ½ç‰¹æ€§æ˜ å°„

### æ·»åŠ æ–°åŠŸèƒ½
1. å®šä¹‰ç»Ÿä¸€çš„æ¥å£
2. å®ç°å„å¹³å°çš„å…·ä½“é€»è¾‘
3. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ `usePlatform` Hook

## ğŸ‰ ä¼˜åŠ¿æ€»ç»“

### âœ… å¼€å‘æ•ˆç‡
- **ä¸€å¥—ä»£ç ï¼Œä¸¤ä¸ªå¹³å°**
- ç»Ÿä¸€çš„å¼€å‘ä½“éªŒ
- å…±äº«çš„ç»„ä»¶å’Œé€»è¾‘

### âœ… ç»´æŠ¤æˆæœ¬
- å•ä¸€ä»£ç åº“ç»´æŠ¤
- ç»Ÿä¸€çš„æµ‹è¯•æµç¨‹
- ä¸€è‡´çš„åŠŸèƒ½æ›´æ–°

### âœ… ç”¨æˆ·ä½“éªŒ
- ç•Œé¢å’Œäº¤äº’ä¸€è‡´
- åŠŸèƒ½æ— ç¼åˆ‡æ¢
- æ€§èƒ½ä¼˜åŒ–ç»Ÿä¸€

### âœ… æŠ€æœ¯å…ˆè¿›æ€§
- ç°ä»£å‰ç«¯æ¶æ„
- ç±»å‹å®‰å…¨ (TypeScript)
- å“åº”å¼è®¾è®¡

è¿™ä¸ªæ¶æ„å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Next.js å’Œæ™ºèƒ½çš„å¹³å°é€‚é…å±‚ï¼Œå®ç°çœŸæ­£çš„"ä¸€å¥—ä»£ç ï¼Œå¤šç«¯è¿è¡Œ"ï¼Œæ˜¯ç°ä»£è·¨å¹³å°åº”ç”¨å¼€å‘çš„æœ€ä½³å®è·µã€‚